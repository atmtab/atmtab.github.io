<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IT Park • Smart Search (Demo)</title>
<style>
  :root{
    --bg:#f6f7fb; --panel:#ffffff; --ink:#1b1f23; --muted:#6b7280; --line:#e6e8ef;
    --green:#86d243; --blue:#2f6df6; --shadow:0 10px 25px rgba(17,24,39,.06);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.35 "Inter",system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .app{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
  .sidebar{background:#fff;border-right:1px solid var(--line);padding:18px 14px;position:sticky;top:0;height:100vh}
  .brand{display:flex;align-items:center;gap:10px;padding-bottom:18px;border-bottom:1px solid var(--line);margin-bottom:12px}
  .brand-logo{width:34px;height:34px;border-radius:50%;display:grid;place-items:center;background:var(--green);color:#fff;font-weight:700}
  .nav .item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;text-decoration:none;color:#2a2f36}
  .nav .item:hover{background:#f1f5f9}
  .nav .item.active{background:#eaffd9;color:#1f3d1f;font-weight:600}

  .main{padding:18px 22px}
  .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
  .headline{font-size:24px;font-weight:800;margin:0 0 4px}
  .toggle{background:#fff;border:1px solid var(--line);border-radius:999px;padding:4px;display:flex;gap:4px}
  .toggle button{border:0;padding:8px 12px;border-radius:999px;background:transparent;cursor:pointer;color:#334155}
  .toggle button.active{background:#eaffd9;color:#1f3d1f;font-weight:700}

  .search{display:flex;gap:8px;width:100%;background:#fff;border:1px solid var(--line);border-radius:12px;padding:10px;box-shadow:var(--shadow);margin-bottom:12px}
  .input{flex:1;border:1px solid var(--line);border-radius:10px;padding:10px 12px}
  .btn{border:0;background:var(--green);color:#0b2f0b;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  .btn.ghost{background:#fff;border:1px solid var(--line);color:#111827}

  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
  .chip{border:1px solid var(--line);background:#fff;padding:6px 10px;border-radius:999px;cursor:pointer}
  .chip.active{background:#eaffd9;border-color:#d9f7b4;color:#1f3d1f;font-weight:600}

  .ai-box{background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);padding:12px 14px;margin:12px 0}
  .ai-text{white-space:pre-wrap}

  .cards{display:grid;gap:10px}
  .card{position:relative;border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff;display:grid;gap:8px}
  .title{font-weight:700}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .tag{background:#f3f4f6;color:#475569;padding:4px 8px;border-radius:999px;font-size:12px}
  .pill{font-size:12px;padding:4px 8px;border-radius:8px}
  .pill.green{background:#ddf9c7;color:#174417}
  .pill.blue{background:#e0ebff;color:#1e3a8a}
  .fp-badge{position:absolute;top:10px;right:10px;background:#fff;border:1px solid var(--line);border-radius:999px;padding:6px 10px;font-size:12px;box-shadow:0 2px 8px rgba(0,0,0,.05)}

  .skeleton{position:relative;overflow:hidden;background:#f1f5f9;border-radius:8px;height:14px}
  .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);background:linear-gradient(90deg,transparent,rgba(255,255,255,.6),transparent);animation:shine 1.3s infinite}
  @keyframes shine{to{transform:translateX(100%)}}
  .placeholder{text-align:center;color:var(--muted);margin-top:20px}

  @media (max-width:880px){.app{grid-template-columns:1fr}.sidebar{display:none}.search{flex-wrap:wrap}.input{min-width:100%}}
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="brand">
      <div class="brand-logo">IT</div>
      <div><div class="headline" style="font-size:16px">IT PARK</div><div style="font-size:12px;color:var(--muted)">Uzbekistan</div></div>
    </div>
    <nav class="nav">
      <a class="item" href="#">Компании</a>
      <a class="item" href="#">Задачи</a>
      <a class="item" href="#">Отчёты</a>
      <a class="item active" href="#">Smart Search</a>
    </nav>
  </aside>

  <main class="main">
    <div class="topbar">
      <div>
        <h1 class="headline">Smart Search</h1>
        <div style="color:var(--muted)">Поиск резидентов по описанию, ключевым словам и ответственным (focal point)</div>
      </div>
      <div class="toggle" role="tablist" aria-label="Режим поиска">
        <button id="mode-ai" class="active" aria-selected="true">AI</button>
        <button id="mode-filters" aria-selected="false">Фильтры</button>
      </div>
    </div>

    <div class="search">
      <input id="q" class="input" placeholder="Введите запрос... (например: erp, финтех, Мухлиса)" />
      <button class="btn" id="run">Поиск</button>
      <button class="btn ghost" id="reset">Сброс</button>
    </div>

    <div id="chips" class="chips" style="display:none"></div>

    <div class="ai-box" id="aiBox" style="display:none">
      <div class="ai-text"><b>AI:</b> <span id="aiText"></span></div>
    </div>

    <div id="placeholder" class="placeholder">Введите свой запрос, и я подберу подходящих резидентов с учётом специализации, отрасли и ответственных лиц.</div>
    <div class="cards" id="cards" style="display:none"></div>
  </main>
</div>

<script>
/* ======= ДАННЫЕ ======= */
const RESIDENTS = [
  { name:"OOO «Sales Doctor Solutions»", sector:["ERP-системы","Базы данных","СУБД","ПО заказное","Медицина"], status:"resident", region:"Резидент IT-Park с 03.12.2019", contact:"+998958449889", extra:"Рейтинг устойчивости: BBB - 83 Средний • Директор: SUVONOV OTABEK IRKINOVICH", focal:"Lazizbek Khudaev" },
  { name:"ООО «BIG DATA SCIENCE»", sector:["Big Data","ERP-системы"], status:"resident", region:"Резидент IT-Park с 07.11.2019", contact:"+998909341343", extra:"Сфера: Финтех и Банки • Рейтинг устойчивости: D - 5 Низкий • Директор: FAZILOV JASUR ABDUXAKIMOVICH", focal:"Rufina Ismailova" },
  { name:"OOO «MIRICO SYSTEMS»", sector:["ERP-системы","Базы данных","СУБД","ПО заказное"], status:"resident", region:"Резидент IT-Park с 03.12.2019", contact:"+998900006231", extra:"Сфера: Финтех и Банки, Бухгалтерия, Бизнес услуги • Рейтинг устойчивости: BBB - 85 Средний • Директор: SABDURAIMOV MIRZIYOD MUXTAROVICH", focal:"Sevinch UBAYDULLAYEVA" },
  { name:"OOO «AGILE MEDIA GROUP»", sector:["ERP-системы","CRM-системы"], status:"resident", region:"Резидент IT-Park с 03.12.2019", contact:"+998909772474", extra:"Сфера: Сельское хозяйство, Бизнес услуги • Рейтинг устойчивости: AA - 92 Высокий • Директор: STAMPLEVSKAYA LYUDMILA VYACHESLAVОВНА", focal:"Fatima Timirova" },
  { name:"OOO «REALSOFT»", sector:["ERP-системы","DMS","ПО заказное","ИС комплексные решения"], status:"resident", region:"Резидент IT-Park с 03.12.2019", contact:"+998712058484", extra:"Сфера: Юридические услуги, Бизнес услуги • Рейтинг устойчивости: B - 56 Средний • Директор: NASRULLAYEV HIKMATULЛО HABIBULLOYEVICH", focal:"Lazizbek Khudaev" },
  { name:"ООО " + "\"ADCOM BTC\"", sector:["Консалтинг","Маркетинг"], status:"resident", region:"Резидент IT-Park с 31.07.2025", contact:"+998910189009", extra:"Рейтинг устойчивости: B - 63 Средний • Директор: YUNUSOV TOLMAS TOXIROVICH", focal:"Mukhlisa Sattarova" },
  { name:"ООО " + "\"PROMO STAFF SOLUTIONS\"", sector:["Консалтинг","Маркетинг"], status:"resident", region:"Резидент IT-Park с 31.07.2025", contact:"+998909573434", extra:"Рейтинг устойчивости: BBB - 77 Средний • Директор: TALIPOV ALISHER SABIROVICH", focal:"Mukhlisa Sattarova" },
  { name:"ООО " + "\"TRANSPROEKT\"", sector:["Консалтинг","Разработка ПО","Транспортное моделирование"], status:"resident", region:"Резидент IT-Park с 31.07.2025", contact:"+998903450504", extra:"Рейтинг устойчивости: B - 58 Средний • Директор: BO‘TTER CHRISTAN", focal:"Mukhlisa Sattarova" },
  { name:"ООО " + "\"COMPLIANCE SHIELD\"", sector:["Информационные услуги","Диспетчерские услуги"], status:"lead", region:"Лид • Заявка на рассмотрении", contact:"+998903338090", extra:"Рейтинг устойчивости: B - 58 Средний • Директор: RAXMATULLAYEV SHERUDXON BOXODIR O‘G‘LI", focal:"Mukhlisa Sattarova" }
];

const ALL_TAGS = Array.from(new Set(RESIDENTS.flatMap(r=>r.sector))).sort();
const STOPWORDS = new Set(["найди","найти","ищу","компания","компании","занимающиеся","занимается","занимаются","которые","по","в","и","с","на","про","о","для","из","сфера","деятельности","find","company","companies","looking"]);

/* ======= DOM ======= */
const chipsEl = document.getElementById('chips');
const colsEl  = document.getElementById('cards');
const aiBox   = document.getElementById('aiBox');
const aiText  = document.getElementById('aiText');
const qEl     = document.getElementById('q');
const runBtn  = document.getElementById('run');
const resetBtn= document.getElementById('reset');
const placeholderEl = document.getElementById('placeholder');
const modeAIEl = document.getElementById('mode-ai');
const modeFiltersEl = document.getElementById('mode-filters');

let mode='ai';
let activeTags = new Set();

/* ======= UI ======= */
function renderChips(){
  chipsEl.innerHTML='';
  ALL_TAGS.forEach(tag=>{
    const b=document.createElement('button');
    b.className='chip'; b.textContent=tag;
    b.onclick=()=>{ if(activeTags.has(tag)){activeTags.delete(tag); b.classList.remove('active');} else {activeTags.add(tag); b.classList.add('active');}
      if(mode==='filters') runSearch();
    };
    chipsEl.appendChild(b);
  });
}

function residencyPillClass(status){ return status==='lead' ? 'pill blue' : 'pill green'; }
function cardTemplate(r){
  return `<div class="card">
    <div class="fp-badge">Focal: ${r.focal}</div>
    <div class="row"><div class="title">${r.name}</div><span class="${residencyPillClass(r.status)}">${r.region}</span></div>
    <div class="row">${r.sector.map(s=>`<span class="tag">${s}</span>`).join('')}</div>
    <div style="color:#64748b">${r.extra} • Контакт: ${r.contact}</div>
  </div>`;
}

function renderSkeletons(){
  colsEl.style.display='grid';
  colsEl.innerHTML='';
  for(let i=0;i<4;i++){
    colsEl.innerHTML += `<div class="card">
      <div class="skeleton" style="height:18px;width:60%"></div>
      <div class="skeleton" style="height:12px;width:90%"></div>
      <div class="skeleton" style="height:12px;width:70%"></div>
    </div>`;
  }
}

function typewrite(targetEl, text, speed=16){
  targetEl.textContent=''; let i=0; return new Promise(res=>{ const t=setInterval(()=>{ targetEl.textContent += text[i++]||''; if(i>=text.length){clearInterval(t); res();}}, speed); });
}

/* ======= SEARCH ======= */
function normalize(s){ return (s||'').toString().toLowerCase().replace('ё','е'); }
function tokenize(q){ return normalize(q).split(/[^a-zа-я0-9ё-]+/i).filter(w=>w && w.length>1 && !STOPWORDS.has(w)); }

function applySpecialFilters(arr, q){
  const nq = normalize(q);
  const hasMukhlisa = /(мухлис|mukhlisa)/i.test(nq);
  const hasERP = /(\berp\b|ерп)/i.test(nq);
  let res = arr;
  if(hasMukhlisa){ res = res.filter(it => normalize(it.focal).includes('mukhlisa')); }
  if(hasERP){ res = res.filter(it => (it.sector||[]).some(s => normalize(s).includes('erp'))); }
  return {res, hasMukhlisa, hasERP};
}

function scoreItem(r, tokens, bonuses){
  const hay = normalize([r.name,r.region,r.contact,r.extra,(r.focal||''),(r.sector||[]).join(' ')].join(' '));
  let s = 0;
  tokens.forEach(t=>{
    if(normalize(r.name).includes(t)) s += 3;
    if((r.sector||[]).some(x=>normalize(x).includes(t))) s += 2;
    if(normalize(r.focal||'').includes(t)) s += 4;
    if(hay.includes(t)) s += 1;
  });
  if(bonuses.hasERP) s += 2;
  if(bonuses.hasMukhlisa) s += 3;
  return s;
}

function searchAI(q){
  let {res, hasMukhlisa, hasERP} = applySpecialFilters(RESIDENTS, q);
  const rawTokens = tokenize(q).filter(t=>t!=='erp' && t!=='ерп' && t!=='mukhlisa' && t!=='мухлиса');
  if(rawTokens.length===0){ return res; }
  const scored = res.map(r=>({r, s:scoreItem(r, rawTokens, {hasERP, hasMukhlisa})})).sort((a,b)=>b.s-a.s);
  const maxS = scored.length? scored[0].s : 0;
  const filtered = scored.filter(x=>x.s>0);
  return (filtered.length? filtered : scored).map(x=>x.r);
}

function searchByFilters(q){
  let arr = RESIDENTS;
  if(activeTags.size){ arr = arr.filter(r => [...activeTags].every(t=> (r.sector||[]).includes(t))); }
  const {res} = applySpecialFilters(arr, q);
  const tokens = tokenize(q);
  if(tokens.length===0) return res;
  return res.filter(r=>{
    const hay = normalize([r.name,r.region,r.contact,r.extra,(r.focal||''),(r.sector||[]).join(' ')].join(' '));
    return tokens.some(t=> hay.includes(t));
  });
}

/* ======= RUN / RESET ======= */
async function runSearch(){
  const q = qEl.value || '';
  placeholderEl.style.display='none';
  colsEl.style.display='grid';

  renderSkeletons();

  if(mode==='ai'){
    chipsEl.style.display='none';
    aiBox.style.display='';
    const narrative = `Запрос: «${q.trim()||'—'}». Подбор выполнен с учётом ключевых слов, отраслевых направлений и ответственных лиц.`;
    await new Promise(r=>setTimeout(r,350));
    await typewrite(aiText, narrative);
    const items = searchAI(q);
    colsEl.innerHTML = items.length ? items.map(cardTemplate).join('') : `<div class="placeholder">Ничего не найдено</div>`;
  } else {
    chipsEl.style.display='flex';
    aiBox.style.display='none';
    await new Promise(r=>setTimeout(r,300));
    const items = searchByFilters(q);
    colsEl.innerHTML = items.length ? items.map(cardTemplate).join('') : `<div class="placeholder">Ничего не найдено</div>`;
  }
}

function resetAll(){
  qEl.value=''; activeTags.clear();
  Array.from(chipsEl.querySelectorAll('.chip')).forEach(c=>c.classList.remove('active'));
  colsEl.style.display='none'; colsEl.innerHTML='';
  aiText.textContent=''; aiBox.style.display='none';
  placeholderEl.style.display='block';
}

modeAIEl.onclick = ()=>{ mode='ai'; modeAIEl.classList.add('active'); modeFiltersEl.classList.remove('active'); chipsEl.style.display='none'; };
modeFiltersEl.onclick = ()=>{ mode='filters'; modeFiltersEl.classList.add('active'); modeAIEl.classList.remove('active'); chipsEl.style.display='flex'; };
runBtn.onclick = runSearch; resetBtn.onclick = resetAll; qEl.addEventListener('keydown', e=>{ if(e.key==='Enter') runSearch();});

/* INIT */
renderChips();
</script>
</body>
</html>
